<!doctype html>
<html>
<head>
  <LINK href='style.css' rel='stylesheet' type='text/css'>
  <script src='jquery-1.9.1.min.js' type="text/javascript"></script>
  <script src='datamaps-world.js' type="text/javascript"></script>
  <script src="reconnecting-websocket.min.js" type="text/javascript"></script>
  <script src="main.js" type="text/javascript" type="text/javascript"></script>
  <script>
        var RC_LOG_SIZE = 20;
        var EN_URL = 'ws://wikimon.hatnote.com:9000';
        var DE_URL = 'ws://wikimon.hatnote.com:9010';
        var RU_URL = 'ws://wikimon.hatnote.com:9020';
        var JA_URL = 'ws://wikimon.hatnote.com:9030';
        var ES_URL = 'ws://wikimon.hatnote.com:9040';
        var FR_URL = 'ws://wikimon.hatnote.com:9050'; <!-- TODO ports, hrm -->


        /*  ================================================================ */
        $(document).ready(function() {
          $('body').append('<div id="loading"><p>Connecting ...</p></div>')
            world_map = $("#map")
                .datamap({scope: 'world',
                          bubbles:[],
                          geography_config: {
                          highlightOnHover: false,
                          popupOnHover: false
                         },
                        bubble_config: {
                            borderWidth: 0,
                            borderColor: '#000',
                            popupOnHover: true,
                            popupTemplate: _.template('<div class="hoverinfo"><%= data.page_title %> <span class="lang">(<%= data.lid %>)</span></div>'),
                            fillOpacity: 0.75,
                            animate: true,
                            highlightOnHover: true,
                            highlightBorderColor: '#667FAF',
                            highlightFillColor: '#667FAF',
                            highlightBorderWidth: 1,
                            highlightFillOpacity: 0.85
                        },
                        fills: {
                            defaultFill: '#ccc',
                            'add': '#306596',
                            'subtract': '#cc4731'
                        }
                 });
            world_map.addBubbles = addBubbles;
            var en_box = $('#en-enable');
            toggler(en_box, EN_URL, 'en');
            var de_box = $('#de-enable');
            toggler(de_box, DE_URL, 'de');
            var ja_box = $('#ja-enable');
            toggler(ja_box, JA_URL, 'ja');
            var ru_box = $('#ru-enable');
            toggler(ru_box, RU_URL, 'ru');
            var es_box = $('#es-enable');
            toggler(es_box, ES_URL, 'es');
            var es_box = $('#fr-enable');
            toggler(es_box, FR_URL, 'fr');
            return;
        });
  </script>
</head>
<body>
    <div id="head">
      <h1>Wikipedia Recent Changes Map</h1>
    </div>
    <div class="content">
    <div id="wrapper">
        <div id="map"></div>
    </div>
    <div class="bg">
      <div class="rc-list">
        <h3>Recent changes</h3>
        <ul id="rc-list">
        </ul>
        <div class="note">
          <p id="edit_counter"></p>
          <p>For more, see Wikipedia's RecentChanges pages for <a href="http://www.wikipedia.org/">each language</a>.</p>
        </div>
      </div>
    </div>
    <div class="foot">
      <h3>Settings</h3>
      <p><input type="checkbox" name="English" id="en-enable" checked/><label for="English">English Wikipedia <span class="conStatus" id="en-status"></span></label></p>
      <p><input type="checkbox" name="German" id="de-enable"/><label for="German">German Wikipedia <span class="conStatus" id="de-status"></span></label></p>
      <p><input type="checkbox" name="Japanese" id="ja-enable"/><label for="Japanese">Japanese Wikipedia <span class="conStatus" id="ja-status"></span></label></p>
      <p><input type="checkbox" name="Russian" id="ru-enable"/><label for="Russian">Russian Wikipedia <span class="conStatus" id="ru-status"></span></label></p>
      <p><input type="checkbox" name="Spanish" id="es-enable"/><label for="Spanish">Spanish Wikipedia <span class="conStatus" id="es-status"></span></label></p>
      <p><input type="checkbox" name="French" id="fr-enable"/><label for="French">French Wikipedia <span class="conStatus" id="fr-status"></span></label></p>
      <h3>What is this map?</h3>
      <p><a href='http://blog.hatnote.com/post/49342528753/wikipedia-recent-changes-map'>Read more</a> about this project.</p>
      <p>
        When an <a href="http://en.wikipedia.org/wiki/Wikipedia:User_access_levels#Unregistered_users">unregistered user</a> edits Wikipedia,
        he or she is identified by his or her <acronym title="Internet Protocol">IP</acronym> address. These IP addresses are
        translated to users' approximate geographic location. Edits by registered users do not have associated IP information,
        so the map actually represents only a small portion of the <a href="http://en.wikipedia.org/wiki/Special:RecentChanges">total
          edit activity on Wikipedia</a>.
      </p>
      <p>
        Built using <a href="http://d3js.org">d3</a>, <a href="http://datamaps.github.io">DataMaps</a>,
        <a href="http://freegeoip.net/">freegeoip.net</a>, and
        the <a href="http://meta.wikimedia.org/wiki/Research:Data#IRC_Feeds">Wikimedia RecentChanges IRC feed</a>,
        broadcast through <a href="https://github.com/hatnote/wikimon">wikimon</a>.
        Source <a href="https://github.com/hatnote/rcmap">available on github</a>.
      </p>
      <p>Built by <a href="https://github.com/slaporte">Stephen LaPorte</a> and <a href="https://github.com/mahmoud">Mahmoud Hashemi</a>.</p>
    </div>
    </div>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-40320359-1', 'hatnote.com');
    ga('send', 'pageview');
    </script>
</body>
</html>
